<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiberLog - GoErrorKit Demo with Multi-Layer Architecture</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .section {
            margin-bottom: 35px;
        }
        .section-title {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .error-list {
            list-style: none;
        }
        .error-item {
            margin-bottom: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .error-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        .error-link {
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            font-size: 0.95em;
        }
        .error-link:hover {
            color: #764ba2;
        }
        .error-desc {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 700;
            margin-right: 8px;
        }
        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        .method-delete { background: #dc3545; color: white; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
        }
        .badge-panic { background: #dc3545; color: white; }
        .badge-4xx { background: #ffc107; color: #333; }
        .badge-5xx { background: #dc3545; color: white; }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        .note strong {
            color: #856404;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }
        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            margin: 0;
            font-size: 1.3em;
        }
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close:hover {
            opacity: 0.7;
        }
        .modal-body {
            padding: 25px;
            max-height: 500px;
            overflow-y: auto;
        }
        .response-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
            border-left: 4px solid #667eea;
        }
        .status-success {
            border-left-color: #28a745;
        }
        .status-error {
            border-left-color: #dc3545;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .clickable {
            cursor: pointer;
        }
        .clickable:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ FiberLog - GoErrorKit Demo</h1>
        <p class="subtitle">Demo GoErrorKit v·ªõi Multi-Layer Architecture - Error tracking t·ª´ Service Layer ƒë·∫øn API Layer</p>
        
        <div class="section">
            <h2 class="section-title">‚ö° Panic Errors (Recovered)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/panic/division" class="error-link">
                        <span class="method method-get">GET</span>
                        /panic/division
                        <span class="badge badge-panic">PANIC</span>
                    </a>
                    <div class="error-desc">
                        ‚ùå L·ªói chia cho 0 - Demo panic recovery v·ªõi l·ªói runtime c∆° b·∫£n
                    </div>
                </li>
                <li class="error-item">
                    <a href="/panic/index" class="error-link">
                        <span class="method method-get">GET</span>
                        /panic/index
                        <span class="badge badge-panic">PANIC</span>
                    </a>
                    <div class="error-desc">
                        ‚ùå Index out of range - Demo panic khi truy c·∫≠p m·∫£ng ngo√†i ph·∫°m vi
                    </div>
                </li>
                <li class="error-item">
                    <a href="/panic/stack" class="error-link">
                        <span class="method method-get">GET</span>
                        /panic/stack
                        <span class="badge badge-panic">PANIC</span>
                    </a>
                    <div class="error-desc">
                        ‚ùå Deep call stack - Demo panic trong chu·ªói g·ªçi h√†m nhi·ªÅu t·∫ßng (X‚ÜíY‚ÜíZ‚ÜíW‚ÜíGetElement)
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">üì¶ Service Layer Errors - Demo GoErrorKit v·ªõi Package kh√°c</h2>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                ‚ú® <strong>Errors ƒë∆∞·ª£c throw t·ª´ <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">services/</code> package</strong> - 
                GoErrorKit s·∫Ω b√°o ch√≠nh x√°c file, line, function n∆°i l·ªói x·∫£y ra!
            </p>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/product/999" class="error-link">
                        <span class="method method-get">GET</span>
                        /product/999
                        <span class="badge badge-4xx">404</span>
                    </a>
                    <div class="error-desc">
                        üîç <strong>BusinessError t·ª´ ProductService.GetProduct</strong><br>
                        S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">services/product_service.go</code>
                    </div>
                </li>
                <li class="error-item">
                    <a href="/product/123/check-stock" class="error-link">
                        <span class="method method-get">GET</span>
                        /product/123/check-stock
                        <span class="badge badge-4xx">400</span>
                    </a>
                    <div class="error-desc">
                        üìâ <strong>BusinessError t·ª´ ProductService.CheckStock</strong><br>
                        S·∫£n ph·∫©m h·∫øt h√†ng (iPhone 15) ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">CheckStock function</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/product/456/reserve?quantity=10" data-method="POST">
                        <span class="method method-post">POST</span>
                        /product/456/reserve?quantity=10
                        <span class="badge badge-4xx">400</span>
                    </span>
                    <div class="error-desc">
                        ‚ö†Ô∏è <strong>ValidationError t·ª´ ProductService.ReserveProduct</strong><br>
                        Kh√¥ng ƒë·ªß h√†ng (y√™u c·∫ßu 10, ch·ªâ c√≤n 5) ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">ReserveProduct function</code><br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X POST "http://localhost:8081/product/456/reserve?quantity=10"</code>
                    </div>
                </li>
                <li class="error-item">
                    <a href="/product/456/discount?percent=150" class="error-link">
                        <span class="method method-get">GET</span>
                        /product/456/discount?percent=150
                        <span class="badge badge-4xx">400</span>
                    </a>
                    <div class="error-desc">
                        üíØ <strong>ValidationError t·ª´ ProductService.CalculateDiscount</strong><br>
                        Ph·∫ßn trƒÉm gi·∫£m gi√° kh√¥ng h·ª£p l·ªá (max 100) ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">CalculateDiscount function</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/order/create?product_id=123&quantity=1" data-method="POST">
                        <span class="method method-post">POST</span>
                        /order/create?product_id=123&quantity=1
                        <span class="badge badge-4xx">400</span>
                    </span>
                    <div class="error-desc">
                        üõí <strong>Error propagate qua OrderService</strong><br>
                        OrderService ‚Üí ProductService ‚Üí CheckStock (h·∫øt h√†ng) ‚Üí Error t·ª´ deep call stack<br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X POST "http://localhost:8081/order/create?product_id=123&quantity=1"</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/order/create?product_id=456&quantity=0" data-method="POST">
                        <span class="method method-post">POST</span>
                        /order/create?product_id=456&quantity=0
                        <span class="badge badge-4xx">400</span>
                    </span>
                    <div class="error-desc">
                        üî¢ <strong>ValidationError t·ª´ OrderService.CreateOrder</strong><br>
                        S·ªë l∆∞·ª£ng ph·∫£i > 0 ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">services/order_service.go</code><br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X POST "http://localhost:8081/order/create?product_id=456&quantity=0"</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/order/ORD-shipped/cancel" data-method="DELETE">
                        <span class="method method-delete">DELETE</span>
                        /order/ORD-shipped/cancel
                        <span class="badge badge-4xx">400</span>
                    </span>
                    <div class="error-desc">
                        üö´ <strong>BusinessError t·ª´ OrderService.CancelOrder</strong><br>
                        Kh√¥ng th·ªÉ h·ªßy ƒë∆°n ƒë√£ ship ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">CancelOrder function</code><br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X DELETE "http://localhost:8081/order/ORD-shipped/cancel"</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/order/ORD-invalid-card/payment?amount=100" data-method="POST">
                        <span class="method method-post">POST</span>
                        /order/ORD-invalid-card/payment?amount=100
                        <span class="badge badge-5xx">502</span>
                    </span>
                    <div class="error-desc">
                        üí≥ <strong>ExternalError t·ª´ deep call stack</strong><br>
                        OrderService ‚Üí callPaymentGateway ‚Üí Th·∫ª kh√¥ng h·ª£p l·ªá ‚Üí Error t·ª´ private function<br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X POST "http://localhost:8081/order/ORD-invalid-card/payment?amount=100"</code>
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/order/ORD-123/payment?amount=20000" data-method="POST">
                        <span class="method method-post">POST</span>
                        /order/ORD-123/payment?amount=20000
                        <span class="badge badge-5xx">504</span>
                    </span>
                    <div class="error-desc">
                        ‚è±Ô∏è <strong>ExternalError - Payment Gateway Timeout</strong><br>
                        Giao d·ªãch qu√° l·ªõn c·∫ßn x√°c nh·∫≠n ‚Üí Error t·ª´ <code style="background:#e9ecef;padding:2px 4px;border-radius:3px;">callPaymentGateway</code><br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">curl -X POST "http://localhost:8081/order/ORD-123/payment?amount=20000"</code>
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">üíº Business Errors - Basic (4xx)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/error/business?product_id=123" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/business?product_id=123
                        <span class="badge badge-4xx">404</span>
                    </a>
                    <div class="error-desc">
                        üõí L·ªói business logic - S·∫£n ph·∫©m h·∫øt h√†ng (g·ªçi service layer)
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">‚úÖ Validation Errors (400)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/error/validation" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/validation
                        <span class="badge badge-4xx">400</span>
                    </a>
                    <div class="error-desc">
                        üìù Thi·∫øu query param - Th·ª≠ th√™m ?age=25 ƒë·ªÉ th√†nh c√¥ng, ?age=15 s·∫Ω l·ªói (tu·ªïi < 18)
                    </div>
                </li>
                <li class="error-item">
                    <span class="error-link" data-url="/error/validation-body" data-method="POST">
                        <span class="method method-post">POST</span>
                        /error/validation-body
                        <span class="badge badge-4xx">400</span>
                    </span>
                    <div class="error-desc">
                        üìù Validation request body - Click ƒë·ªÉ test validation body (g·ª≠i body r·ªóng ƒë·ªÉ test error)<br>
                        <code style="background:#e9ecef;padding:2px 6px;border-radius:3px;">
                        Ho·∫∑c: curl -X POST http://localhost:8081/error/validation-body -H "Content-Type: application/json" -d '{"name":"John","email":"john@test.com","age":25}'
                        </code>
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">üîê Authentication/Authorization Errors (401-403)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/error/auth" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/auth
                        <span class="badge badge-4xx">401</span>
                    </a>
                    <div class="error-desc">
                        üîí Thi·∫øu token - Th·ª≠ v·ªõi header: Authorization: Bearer valid-token-123 v√† X-User-Role: admin ƒë·ªÉ th√†nh c√¥ng
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">üåê External Service Errors (502-504)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/error/external?service=payment" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/external?service=payment
                        <span class="badge badge-5xx">502</span>
                    </a>
                    <div class="error-desc">
                        üí≥ Payment gateway kh√¥ng ph·∫£n h·ªìi - Demo l·ªói t·ª´ external API
                    </div>
                </li>
                <li class="error-item">
                    <a href="/error/external?service=shipping" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/external?service=shipping
                        <span class="badge badge-5xx">503</span>
                    </a>
                    <div class="error-desc">
                        üì¶ Shipping service ƒëang b·∫£o tr√¨ - Demo service unavailable
                    </div>
                </li>
                <li class="error-item">
                    <a href="/error/external?service=notification" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/external?service=notification
                        <span class="badge badge-5xx">504</span>
                    </a>
                    <div class="error-desc">
                        üìß Notification service timeout - Demo gateway timeout
                    </div>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">‚öôÔ∏è System Errors (500)</h2>
            <ul class="error-list">
                <li class="error-item">
                    <a href="/error/system" class="error-link">
                        <span class="method method-get">GET</span>
                        /error/system
                        <span class="badge badge-5xx">500</span>
                    </a>
                    <div class="error-desc">
                        üóÑÔ∏è Database connection failed - Demo l·ªói h·ªá th·ªëng internal
                    </div>
                </li>
            </ul>
        </div>

        <div class="note">
            <strong>üìå L∆∞u √Ω:</strong> T·∫•t c·∫£ l·ªói ƒë·ªÅu ƒë∆∞·ª£c x·ª≠ l√Ω t·ª± ƒë·ªông b·ªüi ErrorHandlerMiddleware 
            v√† log ra console v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin (request_id, error_type, location, call_chain, etc.)
        </div>

        <div class="note" style="background: #d1ecf1; border-left-color: #0c5460; margin-top: 15px;">
            <strong style="color: #0c5460;">üéØ ƒêi·ªÉm ƒë·∫∑c bi·ªát c·ªßa GoErrorKit:</strong><br>
            V·ªõi <strong>Service Layer Errors</strong> section ph√≠a tr√™n, errors ƒë∆∞·ª£c throw t·ª´ package <code style="background:#b8daff;padding:2px 6px;border-radius:3px;">services/</code> 
            nh∆∞ng GoErrorKit v·∫´n b√°o <strong>ch√≠nh x√°c</strong>:<br>
            ‚úÖ File: <code style="background:#b8daff;padding:2px 4px;border-radius:3px;">product_service.go</code> ho·∫∑c <code style="background:#b8daff;padding:2px 4px;border-radius:3px;">order_service.go</code><br>
            ‚úÖ Line number: D√≤ng th·ª±c s·ª± throw error<br>
            ‚úÖ Function: <code style="background:#b8daff;padding:2px 4px;border-radius:3px;">CheckStock</code>, <code style="background:#b8daff;padding:2px 4px;border-radius:3px;">ReserveProduct</code>, etc.<br>
            ‚úÖ Full call stack t·ª´ n∆°i error x·∫£y ra<br><br>
            üëâ Check file <code style="background:#b8daff;padding:2px 6px;border-radius:3px;">logs/errors.log</code> ƒë·ªÉ xem chi ti·∫øt!
        </div>
    </div>

    <!-- Modal ƒë·ªÉ hi·ªÉn th·ªã response -->
    <div id="responseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Response</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // H√†m g·ª≠i request (GET, POST, DELETE)
        async function sendRequest(url, method = 'GET') {
            const modal = document.getElementById('responseModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            // Hi·ªÉn th·ªã modal v·ªõi loading
            modal.style.display = 'block';
            modalTitle.textContent = `${method} ${url}`;
            modalBody.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Sending ${method} request...</p>
                </div>
            `;
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const contentType = response.headers.get('content-type');
                let data;
                
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }
                
                // Hi·ªÉn th·ªã response
                const statusClass = response.ok ? 'status-success' : 'status-error';
                const statusEmoji = response.ok ? '‚úÖ' : '‚ùå';
                
                modalBody.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>${statusEmoji} Status:</strong> ${response.status} ${response.statusText}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>üìÑ Response:</strong>
                    </div>
                    <div class="response-box ${statusClass}">
${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}
                    </div>
                `;
            } catch (error) {
                modalBody.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>‚ùå Error:</strong> Failed to send request
                    </div>
                    <div class="response-box status-error">
${error.message}
                    </div>
                `;
            }
        }
        
        // ƒê√≥ng modal
        function closeModal() {
            document.getElementById('responseModal').style.display = 'none';
        }
        
        // ƒê√≥ng modal khi click outside
        window.onclick = function(event) {
            const modal = document.getElementById('responseModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // X·ª≠ l√Ω click tr√™n c√°c link
        document.addEventListener('DOMContentLoaded', function() {
            // Th√™m event listener cho c√°c link c√≥ data-url v√† data-method
            document.querySelectorAll('.error-link[data-url]').forEach(link => {
                const url = link.getAttribute('data-url');
                const method = link.getAttribute('data-method') || 'POST';
                
                // Th√™m class clickable
                link.classList.add('clickable');
                
                // Th√™m event listener
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    sendRequest(url, method);
                });
            });
            
            // C√°c link GET v·∫´n ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng (m·ªü tab m·ªõi)
            document.querySelectorAll('a.error-link').forEach(link => {
                if (link.href && !link.hasAttribute('data-url')) {
                    link.setAttribute('target', '_blank');
                }
            });
        });
    </script>
</body>
</html>

